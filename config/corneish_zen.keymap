/*
*
* Copyright (c) 2023 Alex Montgomery
* SPDX-License-Identifier: MIT
*
*/

#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/mouse.h>

// Layer aliases
#define QWERTY  0
#define NAV     1
#define MEDIABT 2
#define SYMBOL  3
#define NUMBER  4
#define MOUSE   5
#define FNLAYER 6

// window manager shortcuts
#define WTOPLEFT  LC(LA(U))
#define WTOP      LC(LA(UP))
#define WTOPRIGHT LC(LA(I))
#define WLEFT     LC(LA(LEFT))
#define WCENTER   LC(LA(ENTER))
#define WRIGHT    LC(LA(RIGHT))
#define WBTMLEFT  LC(LA(J))
#define WBOTTOM   LC(LA(DOWN))
#define WBTMRIGHT LC(LA(K))
#define WNEXTSCRN RC(RA(RG(RIGHT)))
#define WPREVSCRN RC(RA(RG(LEFT)))

// tab navigation shotrcuts
#define TAB_RT   LC(TAB)
#define TAB_LT   LC(LS(TAB))
#define FILEMENU LC(F2)
#define DOCK     LC(F3)

// media navigation shortcuts
#define FWD10S   LG(LA(RIGHT_ARROW)) 
#define RWD10S   LG(LA(LEFT_ARROW))
#define FWD1M   LG(LS(RIGHT_ARROW)) 
#define RWD1M   LG(LS(LEFT_ARROW))

/ {
  chosen {
    zmk,matrix_transform = &default_transform;
    //zmk,matrix_transform = &five_column_transform;
  };
};

&mmv {
    time-to-max-speed-ms = <1000>;
    acceleration-exponent=<1>;
};

/ {
        behaviors {
                ms: mod_sticky_key {
                compatible = "zmk,behavior-hold-tap";
                #binding-cells = <2>;
                flavor = "hold-preferred";
                tapping-term-ms = <200>;
                bindings = <&kp>, <&sk>;
                };
                ctrlAlt: tap_dance_0 {
                compatible = "zmk,behavior-tap-dance";
                #binding-cells = <0>;
                tapping-term-ms = <200>;
                bindings = <&ms LS(LC(LALT)) RALT>, <&sk RCTL>, <&sk RC(RALT)>;
                };
                shiftCap: tap_dance_1 {
                compatible = "zmk,behavior-tap-dance";
                #binding-cells = <0>;
                tapping-term-ms = <200>;
                bindings = <&sk LSHIFT>, <&kp CAPSLOCK>;
                };
                qweNavMda: tap_dance_2 {
                compatible = "zmk,behavior-tap-dance";
                #binding-cells = <0>;
                tapping-term-ms = <300>;
                bindings = <&to QWERTY>, <&to NAV>, <&to MEDIABT>;
                };
                symNumMse: tap_dance_3 {
                compatible = "zmk,behavior-tap-dance";
                #binding-cells = <0>;
                tapping-term-ms = <300>;
                bindings = <&to SYMBOL>, <&to NUMBER>, <&to MOUSE>;
                };
                mediaCtrl: media_hold_tap {
                compatible = "zmk,behavior-hold-tap";
                #binding-cells = <2>;
                flavor = "tap-preferred";
                tapping-term-ms = <200>;
                bindings = <&kp>, <&kp>;
                };
        };

        keymap {
                compatible = "zmk,keymap";

// ╭─ QWERTY ────────────────────────╮   ╭───────────────────────────────────╮
// ⎟ ESC ⎟  Q  ⎟  W  ⎟  E  ⎟  R  ⎟ T ⎟   ⎟  Y  ⎟  U  ⎟  I  ⎟  O  ⎟  P  ⎟ BSP ⎟
// ⎟ TAB ⎟  A  ⎟  S  ⎟  D  ⎟  F  ⎟ G ⎟   ⎟  H  ⎟  J  ⎟  K  ⎟  L  ⎟  ;  ⎟ ENT ⎟
// ⎟CTRL ⎟  Z  ⎟  X  ⎟  C  ⎟  V  ⎟ B ⎟   ⎟  N  ⎟  M  ⎟  ,  ⎟  .  ⎟  /  ⎟  :  ⎟
// ╰─────────────────⎟  ⌘  ⎟  ⧉  ⎟ ⇧ ⎟   ⎟  ␣  ⎟  ⧉  ⎟ ⌃⎇  ⎟─────────────────╯
//                   ╰───────────────╯   ╰─────────────────╯
// ╭─ ADJUST ────────────────────╮   ╭─────────────────────────────╮
// ⎟ ESC ⎟  ↖  ⎟  ↑  ⎟  ↗  ⎟  ⍐  ⎟   ⎟file ⎟ tab←⎟ tab→⎟dock ⎟  ⌫  ⎟
// ⎟  ⇥  ⎟  ←  ⎟  ▣  ⎟  →  ⎟  ⍗  ⎟   ⎟  ◄  ⎟  ▼  ⎟  ▲  ⎟  ►  ⎟  ⮐ ⎟
// ⎟  ~  ⎟  ↙  ⎟  ↓  ⎟  ↘  ⎟  ⊞  ⎟   ⎟     ⎟     ⎟     ⎟     ⎟     ⎟
// ╰───────────⎟  ⌘  ⎟  ⧉  ⎟  ⇧  ⎟   ⎟  ␣  ⎟ ⧉  ⎟ ⌃⎇ ⎟───────────╯
//             ╰─────────────────╯   ╰─────────────────╯
// ╭─ MEDIA/BT ──────────────────╮   ╭─────────────────────────────╮
// ⎟ ESC ⎟ mute⎟ vol-⎟ vol+ ⎟    ⎟   ⎟ clr⦖⎟  ⦖1 ⎟  ⦖2 ⎟ ⦖3 ⎟  ⌫  ⎟
// ⎟  ⇥  ⎟  ◄◄ ⎟  ►  ⎟  ►►  ⎟  ▣ ⎟   ⎟     ⎟  ⦖4 ⎟  ⦖5 ⎟    ⎟  ⮐  ⎟
// ⎟  ~  ⎟ ◄◄◄ ⎟  ◄◄ ⎟  ►►  ⎟ ►►►⎟   ⎟     ⎟  ☼- ⎟  ☼+ ⎟     ⎟     ⎟
// ╰───────────⎟  ⌘  ⎟  ⧉  ⎟  ⇧  ⎟   ⎟  ␣  ⎟ ⧉  ⎟ ⌃⎇ ⎟───────────╯
//             ╰─────────────────╯   ╰─────────────────╯
// ╭─ SYMBOL ────────────────────╮   ╭─────────────────────────────╮
// ⎟ ESC ⎟  @  ⎟  #  ⎟  $  ⎟  %  ⎟   ⎟  ^  ⎟  &  ⎟  *  ⎟  !  ⎟  ⌫  ⎟
// ⎟  ⇥  ⎟  `  ⎟  ’  ⎟  ’  ⎟  '  ⎟   ⎟  \  ⎟  {  ⎟  }  ⎟  ⎟  ⎟ ⮐  ⎟
// ⎟  ~  ⎟  £  ⎟  ”  ⎟  ”  ⎟  "  ⎟   ⎟  [  ⎟  (  ⎟  )  ⎟  ]  ⎟     ⎟
// ╰───────────⎟  ⌘  ⎟  ⧉  ⎟  ⇧  ⎟   ⎟  ␣  ⎟ ⧉  ⎟ ⌃⎇ ⎟───────────╯
//             ╰─────────────────╯   ╰─────────────────╯
// ╭─ NUMBER ────────────────────╮   ╭─────────────────────────────╮
// ⎟ ESC ⎟  <  ⎟   +  ⎟  -  ⎟  > ⎟   ⎟  _  ⎟  7  ⎟  8  ⎟  9  ⎟  ⌫  ⎟
// ⎟   ⇥ ⎟  (  ⎟   *  ⎟  /  ⎟  ) ⎟   ⎟  =  ⎟  4  ⎟  5  ⎟  6  ⎟  ⮐ ⎟
// ⎟   ~ ⎟  ,  ⎟   %  ⎟  ^  ⎟  . ⎟   ⎟  0  ⎟  1  ⎟  2  ⎟  3  ⎟     ⎟
// ╰───────────⎟  ⌘  ⎟  ⧉  ⎟  ⇧  ⎟   ⎟  ␣  ⎟ ⧉  ⎟ ⌃⎇ ⎟───────────╯
//             ╰─────────────────╯   ╰─────────────────╯
// ╭─ MOUSE ─────────────────────╮   ╭─────────────────────────────╮
// ⎟ ESC ⎟     ⎟     ⎟     ⎟     ⎟   ⎟scrl◄⎟scrl▼⎟scrl▲⎟scrl►⎟  ⌫  ⎟
// ⎟  ⇥  ⎟     ⎟     ⎟     ⎟     ⎟   ⎟  ◄  ⎟  ▼  ⎟  ▲  ⎟  ►  ⎟ ⮐  ⎟
// ⎟  ~  ⎟     ⎟     ⎟     ⎟     ⎟   ⎟mse ◄⎟mse ▼⎟mse ▲⎟mse ►⎟     ⎟
// ╰───────────⎟  ⌘  ⎟  ⧉  ⎟  ⇧  ⎟   ⎟ 🖱️1 ⎟ 🖱️2 ⎟  ⧉ ⎟───────────╯
//             ╰─────────────────╯   ╰─────────────────╯

                default_layer {
                        display-name = "QWERTY";
                        bindings = <
// ╭───────┬───────┬───────┬───────┬───────┬───────╮   ╭───────┬───────┬──────────┬───────┬───────┬───────╮
    &kp ESC  &kp Q   &kp W   &kp E   &kp R   &kp T       &kp Y   &kp U   &kp I     &kp O   &kp P   &kp BSPC
// ├───────┼───────┼───────┼───────┼───────┼───────┤   ├───────┼───────┼──────────┼───────┼───────┼───────┤
    &kp TAB  &kp A   &kp S   &kp D   &kp F   &kp G       &kp H   &kp J   &kp K     &kp L   &kp SEMI &kp ENTER
// ├───────┼───────┼───────┼───────┼───────┼───────┤   ├───────┼───────┼──────────┼───────┼───────┼───────┤
    &kp LCTRL &kp Z  &kp X   &kp C   &kp V   &kp B       &kp N   &kp M   &kp COMMA &kp DOT &kp FSLH &kp COLON
// ╰───────┴───────┴───────┼───────┼───────┼───────┤   ├───────┼───────┼──────────┴───────┴───────┴───────╯
                       &kp LGUI &qweNavMda &sk LSHIFT  &kp SPACE &symNumMse &ctrlAlt
//                     ╰─────────┴────────┴────────╯   ╰────────┴────────┴──────────╯
                        >;
                };

                nav_layer {
                        display-name = "NAV";
                        bindings = <
// ╭────────┬──────────┬──────────────┬───────────┬─────────────┬────────────╮   ╭───────────┬───────────┬───────────┬────────┬─────────┬─────────╮
     &kp GRAVE &kp ESC     &kp WTOPLEFT  &kp WTOP    &kp WTOPRIGHT &kp WNEXTSCRN    &kp FILEMENU &kp TAB_LT &kp TAB_RT  &kp DOCK  &kp BSPC   &kp DEL
// ├────────┼──────────┼──────────────┼───────────┼─────────────┼────────────┤   ├───────────┼───────────┼───────────┼────────┼─────────┼─────────┤
     &kp LC(A) &kp TAB     &kp WLEFT     &kp WCENTER &kp WRIGHT    &kp WPREVSCRN    &kp LEFT    &kp DOWN    &kp UP      &kp RIGHT &kp ENTER  &kp LC(W)
// ├────────┼──────────┼──────────────┼───────────┼─────────────┼────────────┤   ├───────────┼───────────┼───────────┼────────┼─────────┼─────────┤
     &kp LC(B) &kp TILDE   &kp WBTMLEFT  &kp WBOTTOM &kp WBTMRIGHT &kp LC(UP)            &kp HOME       &kp PG_DN       &kp PG_UP       &kp END     &none      &kp LC(C)
// ╰────────┴──────────┴──────────────┼───────────┼─────────────┼────────────┤   ├───────────┼───────────┼───────────┴────────┴─────────┴─────────╯
                                                  &kp LGUI &qweNavMda &sk LSHIFT  &kp RALT &symNumMse &ctrlAlt
//                                               ╰─────────┴────────┴────────╯   ╰────────┴────────┴──────────╯
                        >;
                };

                media_layer {
                        display-name = "MEDIA";
                        bindings = <
// ╭───────┬────────┬─────────────────────┬────────────────┬─────────────────────┬────────────╮   ╭──────────┬────────────┬────────────┬────────────┬──────────┬──────╮
     &kp C_SLEEP  &kp ESC  &kp K_MUTE            &kp C_VOL_DN     &kp C_VOL_UP          &trans           &bt BT_CLR &bt BT_SEL 0 &bt BT_SEL 1 &bt BT_SEL 2 &bt BT_SEL 3 &bt BT_SEL 4
// ├───────┼────────┼─────────────────────┼────────────────┼─────────────────────┼────────────┤   ├──────────┼────────────┼────────────┼────────────┼──────────┼──────┤
     &none  &kp TAB  &mediaCtrl LEFT C_PREV &kp C_PLAY_PAUSE &mediaCtrl RIGHT C_NEXT &kp LG(F)     &none      &bt BT_SEL 4 &bt BT_SEL 5 &none        &kp ENTER  &none
// ├───────┼────────┼─────────────────────┼────────────────┼─────────────────────┼────────────┤   ├──────────┼────────────┼────────────┼────────────┼──────────┼──────┤
     &none  &trans   &kp RWD1M             &kp RWD10S       &kp FWD10S            &kp FWD1M        &none      &kp C_BRI_DN &kp C_BRI_UP &none        &none      &none
// ╰───────┴────────┴─────────────────────┼────────────────┼─────────────────────┼────────────┤   ├──────────┼────────────┼────────────┴────────────┴──────────┴──────╯
                                                                  &kp LGUI &qweNavMda &sk LSHIFT  &kp RALT &symNumMse &ctrlAlt
//                                                                ╰─────────┴────────┴────────╯   ╰─────────┴─────────┴──────────╯
                        >;
                };

                sym_layer {
                        display-name = "SYMBOL";
                        bindings = <
// ╭─────────┬─────────┬────────────┬────────────┬───────────────┬─────────────────╮   ╭────────────┬────────────┬──────────────┬────────────┬────────────┬───────────╮
     &kp LPAR    &kp ESC   &kp AT       &kp HASH    &kp DLLR         &kp PRCNT             &kp CARET    &kp AMPS    &kp KP_MULTIPLY  &kp EXCL     &kp BSPC     &kp RPAR
// ├─────────┼─────────┼────────────┼────────────┼───────────────┼─────────────────┤   ├────────────┼────────────┼──────────────┼────────────┼────────────┼───────────┤
     &kp LBKT    &kp TAB   &kp GRAVE   &kp LA(RBRC) &kp LS(LA(RBRC)) &kp SINGLE_QUOTE      &kp BSLH     &kp LBRC     &kp RBRC        &kp PIPE     &kp ENTER    &kp RBKT
// ├─────────┼─────────┼────────────┼────────────┼───────────────┼─────────────────┤   ├────────────┼────────────┼──────────────┼────────────┼────────────┼───────────┤
     &kp LT    &kp TILDE &kp LA(N3)  &kp LA(LBRC) &kp LS(LA(LBRC)) &kp DOUBLE_QUOTES     &kp UNDERSCORE     &kp MINUS     &kp EQUAL        &kp PLUS     &none        &kp GT
// ╰─────────┴─────────┴────────────┼────────────┼───────────────┼─────────────────┤   ├────────────┼────────────┼──────────────┴────────────┴────────────┴───────────╯
                                                      &kp LGUI &qweNavMda &sk LSHIFT  &kp RALT &symNumMse &ctrlAlt
//                                                     ╰─────────┴────────┴────────╯   ╰────────┴────────┴──────────╯
                        >;
                };

                num_layer {
                        display-name = "NUMBER";
                        bindings = <
// ╭─────────┬──────────────┬───────────┬─────────────┬───────────────┬──────────────╮   ╭──────────────┬────────────┬────────────┬────────────┬────────────┬───────────╮
     &kp LC(A)    &kp ESC       &kp LESS_THAN &kp PLUS      &kp MINUS     &kp GREATER_THAN    &kp UNDERSCORE &kp N7       &kp N8       &kp N9       &kp BSPC     &kp COLON
// ├─────────┼──────────────┼───────────┼─────────────┼───────────────┼──────────────┤   ├──────────────┼────────────┼────────────┼────────────┼────────────┼───────────┤
     &mo FNLAYER &kp TAB       &kp LPAR     &kp KP_MULTIPLY &kp KP_DIVIDE &kp RPAR           &kp EQUAL      &kp N4       &kp N5       &kp N6       &kp ENTER    &kp SEMI
// ├─────────┼──────────────┼───────────┼─────────────┼───────────────┼──────────────┤   ├──────────────┼────────────┼────────────┼────────────┼────────────┼───────────┤
     &kp LCTRL    &kp LEFT_SHIFT &kp COMMA   &kp PERCENT    &kp CARET      &kp DOT            &kp N0         &kp N1       &kp N2       &kp N3       &kp DOT       &kp QMARK
// ╰─────────┴──────────────┴───────────┼─────────────┼───────────────┼──────────────┤   ├──────────────┼────────────┼────────────┴────────────┴────────────┴───────────╯
                                                       &kp LGUI &qweNavMda &sk LSHIFT  &kp RALT &symNumMse &ctrlAlt
//                                                     ╰─────────┴────────┴────────╯   ╰────────┴────────┴──────────╯
                        >;
                };

                mouse_layer {
                        display-name = "MOUSE";
                        bindings = <
// ╭───────┬────────┬───────┬──────┬──────┬───────╮   ╭─────────────────┬───────────────┬───────────────┬───────────────┬──────────────┬──────╮
     &none  &kp ESC   &none  &none  &none  &none       &msc SCRL_LEFT &msc SCRL_DOWN &msc SCRL_UP &msc SCRL_RIGHT &kp BACKSPACE &none
// ├───────┼────────┼───────┼──────┼──────┼───────┤   ├─────────────────┼───────────────┼───────────────┼───────────────┼──────────────┼──────┤
     &mkp MB3  &kp TAB   &none  &none  &none  &none       &kp LEFT          &kp DOWN        &kp UP          &kp RIGHT        &kp ENTER     &none
// ├───────┼────────┼───────┼──────┼──────┼───────┤   ├─────────────────┼───────────────┼───────────────┼───────────────┼──────────────┼──────┤
     &none  &kp TILDE &none  &none  &none  &none       &mmv MOVE_LEFT    &mmv MOVE_DOWN  &mmv MOVE_UP    &mmv MOVE_RIGHT  &none         &none
// ╰───────┴────────┴───────┼──────┼──────┼───────┤   ├─────────────────┼───────────────┼───────────────┴───────────────┴──────────────┴──────╯
                       &kp LGUI &qweNavMda &sk LSHIFT  &mkp LCLK &mkp RCLK &symNumMse
//                    ╰──────────┴────────┴───────╯   ╰─────────┴─────────┴──────────╯
                        >;
                };

                fn_layer {
                        display-name = "FUNCTION";
                        bindings = <
// ╭─────────┬──────────────┬───────────┬─────────────┬───────────────┬──────────────╮   ╭──────────────┬────────────┬────────────┬────────────┬────────────┬───────────╮
     &trans      &kp ESC       &kp F10      &kp F11       &kp F12        &trans             &trans         &kp F7       &kp F8       &kp F9       &kp BSPC     &kp F12
// ├─────────┼──────────────┼───────────┼─────────────┼───────────────┼──────────────┤   ├──────────────┼────────────┼────────────┼────────────┼────────────┼───────────┤
     &trans      &kp TAB       &kp F5       &kp F8        &kp F9         &kp F11            &trans         &kp F4       &kp F5       &kp F6       &kp ENTER    &kp F11
// ├─────────┼──────────────┼───────────┼─────────────┼───────────────┼──────────────┤   ├──────────────┼────────────┼────────────┼────────────┼────────────┼───────────┤
     &trans      &trans        &kp F10      &kp F11       &kp F12        &trans             &kp F10        &kp F1       &kp F2       &kp F3       &trans       &trans
// ╰─────────┴──────────────┴───────────┼─────────────┼───────────────┼──────────────┤   ├──────────────┼────────────┼────────────┴────────────┴────────────┴───────────╯
                                                       &trans    &trans      &trans         &trans     &trans      &trans
//                                                     ╰─────────┴────────┴────────╯   ╰────────┴────────┴──────────╯
                        >;
                };
        };
};
